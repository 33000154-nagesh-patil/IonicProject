import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { BehaviorSubject } from 'rxjs';
import { retry } from 'rxjs/operators';


@Injectable({
  providedIn: 'root',
})
export class TcsStock {
  authRequest = {
    BOID: 'RSEC143',
    CID: 'KALPESH',
    Source: 'N',
    UTYPE: 'C',
  };
  authByteArrayRequestApi = {
    bHeader: {
      iRequestCode: 41,
      iMsgLength: 703,
      sClientId: 'KALPESH',
      sAuthToken: '706d0783e47c1285',
    },
    Authorization:
      'UqlahWZfHv8h4e29R0AM7U/XuJC/hsEJhsharbkARzYq0GPVXvc5uwrh6jBjaYRkiv0QdjEO+2Mb921XCv/LXQ==',
    Bid: 'RSEC143',
    Cid: 'KALPESH',
    Src: 'N',
    Utype: 'C',
  };
  apiBaseUrl = 'https://apixuat.heytorus.com/';
  sendbyteArray = new Uint8Array();
  getbyteArray = new Uint8Array();
  tcs = {
    STRIKE_PRICE: 'NA',
    SEGMENT: 'E',
    EXP_DATE: 'NA',
    INST: 'EQUITY',
    SEC_ID: '11536',
    OPT_TYPE: '',
    LOT: '1.0',
    LOWER_LIMIT: '2968.9500',
    SYMBOL: 'TCS',
    TICK: '5.0000',
    EXCHANGE: 'NSE',
    ISIN_CODE: 'INE467B01029',
    UPPER_LIMIT: '3628.6500',
  };
  count: number = 0;
  fBuyprice: any;
  fSellprice: number;
  LCkt: any;
  LTPval: any;
  private messageSource = new BehaviorSubject({});
  currentMessage = this.messageSource.asObservable();

  constructor(private http: HttpClient) { }
  webSocket: WebSocket;
  callApiAuth() {
    this.postApi(
      this.apiBaseUrl,
      'api/v1/wealth/stock/Mpost/Authorization',
      this.authRequest
    )
      //to get authorization code
      .pipe()
      .subscribe(async (res: any) => {
        let param = {
          ...this.authByteArrayRequestApi,
          Authorization: res.Authorization,
        };
        this.postApi(
          this.apiBaseUrl,
          'api/v1/wealth/stock/Mpost/ByteArray',
          param
        )
          //to get byte array for WS auth
          .pipe()
          .subscribe(async (res: any) => {
            this.sendbyteArray = res.data;
            this.openWebsocket(this.sendbyteArray);
          });
      });
  }
  openWebsocket(sendbyteArray: any) {
    console.log(sendbyteArray, 'got data from send bytearray');

    // this.webSocket = new WebSocket('wss://rsecpubuat.reliancesmartmoney.com:8861');
    this.webSocket = new WebSocket(
      'wss://rsecpubuat.reliancesmartmoney.com:8861'
    );

    this.webSocket.binaryType = 'arraybuffer';

    this.webSocket.onopen = (event) => {
      let bytearrayvalue = new Uint8Array(sendbyteArray);
      this.webSocket.send(bytearrayvalue);
      let uint8ViewBajajAuto = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        49,
        54,
        54,
        54,
        57, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      // 0,49, 49, 53, 51,54,//11536
      let uint8ViewAdani = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        49,
        53,
        48,
        56,
        51, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);
      let uint8ViewAxisBank = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        32,
        53,
        57,
        48,
        48, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);
      let uint8ViewTataMotors = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        32,
        51,
        52,
        53,
        54, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewSBIN = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        32,
        51,
        48,
        52,
        53, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewAsianPaints = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        32,
        32,
        50,
        51,
        54, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewBajajFinance = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        32,
        32,
        51,
        49,
        55, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewBPCL = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        32,
        32,
        53,
        50,
        54, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewCIPLA = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        32,
        32,
        54,
        57,
        52, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewBritannia = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        32,
        32,
        53,
        52,
        55, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewBajajFinsv = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        49,
        54,
        54,
        55,
        53, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewBhartiAirtel = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        49,
        48,
        54,
        48,
        52, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewCoalIndia = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        50,
        48,
        51,
        55,
        52, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewDRREDDY = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        32,
        32,
        56,
        56,
        49, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewDIVISLAB = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        49,
        48,
        57,
        52,
        48, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewEICHERMOTORS = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        32,
        32,
        57,
        49,
        48, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewGRASIM = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        32,
        49,
        50,
        51,
        50, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewHCLTECH = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        32,
        55,
        50,
        50,
        57, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewHDFClife = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        32,
        32,
        52,
        54,
        55, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewHDFCBank = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        32,
        49,
        51,
        51,
        51, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewHeroMotoCo = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        32,
        49,
        51,
        52,
        56, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewHindalCo = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        32,
        49,
        51,
        54,
        51, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewHindustanUniLvr = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        32,
        49,
        51,
        57,
        52, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewICICI = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        49,
        48,
        50,
        48,
        49, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewTCS = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        49,
        49,
        53,
        51,
        54, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewyesBank = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        49,
        49,
        57,
        49,
        53, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8Viewidea = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        49,
        52,
        51,
        54,
        54, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewJppower = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        49,
        49,
        55,
        54,
        51, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewTataSteel = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        32,
        51,
        52,
        57,
        57, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewMandM = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        32,
        50,
        48,
        51,
        49, //change scripId
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewITC = new Uint8Array([
        12,
        129,
        0,
        75,
        65,
        76,
        80,
        69,
        83,
        72, //change clientID
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        255,
        255,
        255,
        255,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        32,
        32,
        49,
        54,
        54,
        48,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
      ]);

      let uint8ViewNifty50 = new Uint8Array([24, 129, 0, 49, 48, 48, 48, 48, 55, 57, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
        , 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 1, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 49, 51, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]);

      this.webSocket.send(uint8ViewBajajAuto);
      this.webSocket.send(uint8ViewAdani);
      this.webSocket.send(uint8ViewAxisBank);
      this.webSocket.send(uint8ViewTataMotors);
      this.webSocket.send(uint8ViewSBIN);
      this.webSocket.send(uint8ViewAsianPaints);
      this.webSocket.send(uint8ViewBajajFinance);
      this.webSocket.send(uint8ViewBPCL);
      this.webSocket.send(uint8ViewCIPLA);
      this.webSocket.send(uint8ViewBritannia);
      this.webSocket.send(uint8ViewBajajFinsv);
      this.webSocket.send(uint8ViewBhartiAirtel);
      this.webSocket.send(uint8ViewNifty50);

      this.webSocket.send(uint8ViewCoalIndia);
      this.webSocket.send(uint8ViewDRREDDY);
      this.webSocket.send(uint8ViewDIVISLAB);
      this.webSocket.send(uint8ViewEICHERMOTORS);
      this.webSocket.send(uint8ViewGRASIM);
      this.webSocket.send(uint8ViewHCLTECH);
      this.webSocket.send(uint8ViewHDFClife);
      this.webSocket.send(uint8ViewHDFCBank);
      this.webSocket.send(uint8ViewHeroMotoCo);
      this.webSocket.send(uint8ViewHindalCo);
      this.webSocket.send(uint8ViewHindustanUniLvr);
      this.webSocket.send(uint8ViewICICI);
      this.webSocket.send(uint8ViewTCS);
      this.webSocket.send(uint8ViewyesBank);
      this.webSocket.send(uint8Viewidea);
      this.webSocket.send(uint8ViewJppower);
      this.webSocket.send(uint8ViewTataSteel);
      this.webSocket.send(uint8ViewMandM);
      this.webSocket.send(uint8ViewITC);
    };
    this.webSocket.onmessage = (event) => {
      let exch = new Int8Array(event.data.slice(0, 1))[0];
      let scripId = new Uint32Array(event.data.slice(1, 5))[0];
      let scripId1 = new Uint32Array(event.data.slice(5, 9))[0];
      let msgLength = new Int8Array(event.data.slice(9, 10))[0];
      let msgCode = new Int8Array(event.data.slice(10, 11))[0];
      //first header body

      //first body

      this.LTPval = new Float32Array(event.data.slice(11, 15))[0]?.toFixed(2);
      let UCkt = new Float32Array(event.data.slice(221, 225))[0];
      let LCkt = new Float32Array(event.data.slice(225, 229))[0];
      let LTQ = new Int16Array(event.data.slice(15, 17))[0];
      let VOL = new Uint32Array(event.data.slice(17, 21))[0];
      let ATP = new Float32Array(event.data.slice(21, 25))[0];
      let OI = new Float32Array(event.data.slice(25, 29))[0];
      let LTT = new Int16Array(event.data.slice(29, 33))[0];

      let fOpen = new Float32Array(event.data.slice(48, 52))[0];
      let fClose = new Float32Array(event.data.slice(52, 56))[0];
      let fHigh = new Float32Array(event.data.slice(56, 60))[0];
      let fLow = new Float32Array(event.data.slice(60, 64))[0];

      let marketStatus = new Float32Array(event.data.slice(210, 214))[0];

      let exchnew = new Int8Array(event.data.slice(99, 100))[0];
      let scripIdnew = new Uint32Array(event.data.slice(100, 104))[0];
      let scripId1new = new Uint32Array(event.data.slice(104, 108))[0];
      let msgLengthnew = new Int8Array(event.data.slice(108, 109))[0];
      let msgCodenew = new Int8Array(event.data.slice(109, 110))[0];
      let iBuyqtycall5times = new Uint32Array(
        event.data.slice(110, 114)
      )[0]?.toFixed(2);
      let iSellqtycall5times = new Uint32Array(
        event.data.slice(114, 118)
      )[0]?.toFixed(2);
      let iBuyordnocall5times = new Int8Array(
        event.data.slice(118, 119)
      )[0]?.toFixed(2);
      let iSellordnocall5times = new Int8Array(
        event.data.slice(119, 120)
      )[0]?.toFixed(2);
      let fBuypricecall5times = new Float32Array(
        event.data.slice(120, 124)
      )[0]?.toFixed(2);
      let fSellpricecall5times = new Float32Array(
        event.data.slice(124, 128)
      )[0]?.toFixed(2);

      console.log(exchnew, 'exchnew');
      console.log(scripIdnew, 'scripIdnew');
      console.log(scripId1new, 'scripId1new');
      console.log(msgLengthnew, 'msgLengthnew');
      console.log(msgCodenew, 'msgCodenew');

      console.log(iBuyqtycall5times, 'BuyQTY');
      console.log(iSellqtycall5times, 'SellQTY');
      console.log(iBuyordnocall5times, 'BuyQTY');
      console.log(iSellordnocall5times, 'SellQTY');
      console.log(fBuypricecall5times, 'BuyQTY');
      console.log(fSellpricecall5times, 'SellQTY');
      console.log(marketStatus, 'marketStatus');

      this.getTCSStock(
        this.LTPval,
        scripId,
        fClose,
        UCkt,
        LCkt,
        ATP,
        OI,
        LTT,
        VOL,
        LTQ,
        fOpen,
        fHigh,
        fLow
      );
      // this.fBuyprice = new Float32Array(event.data.slice(221, 225))[0].toFixed(2);
      // let LCkt = new Float32Array(event.data.slice(225, 229))[0].toFixed(2);;

      // console.log(UCkt,"UCkt");
      // console.log(this.LTPval, 'LTP value');
    };
    this.webSocket.onclose = (event) => {
      console.log(event);
    };
  }
  callTCS(stock) {
    let req_code = 12;
    if (stock.EXCHANGE == 'NSE') req_code = 12;

    let segExch = getSignalRSeg(stock.EXCHANGE, stock.SEGMENT);

    let position = 0;
    let arrbuffer = new ArrayBuffer(129);
    let view = new DataView(arrbuffer, 0, arrbuffer.byteLength);
    view.setInt8(position, req_code);
    position++;
    view.setUint16(position, 129, true);
    position += 2;
    let id_new = pad('A00055748', 30, '', 2);
    for (let i = 0; i < 30; i++) {
      view.setInt8(position, id_new.charCodeAt(i));
      position++;
    }
    let name_new = pad('', 50, '', 2);
    for (let i = 0; i < 50; i++) {
      view.setInt8(position, name_new.charCodeAt(i));
      position++;
    }

    view.setInt8(position, segExch);
    position++;
    view.setInt32(position, -1);
    position += 4;
    view.setInt8(position, 1);
    position++;

    let id_pad = pad('abc', 20, '', 2);
    for (let i = 0; i < 20; i++) {
      view.setInt8(position, id_pad.charCodeAt(i));
      position++;
    }

    let name_pad = pad(stock.SEC_ID, 20, '', 2);
    for (let i = 0; i < 20; i++) {
      view.setInt8(position, name_pad.charCodeAt(i));
      position++;
    }
  }
  postApi(baseUrl, func, param) {
    return this.http.post(baseUrl + func, param);
  }

  getTCSStock(
    val,
    arg,
    fClose,
    UCkt,
    LCkt,
    ATP,
    OI,
    LTT,
    VOL,
    LTQ,
    fOpen,
    fHigh,
    fLow
  ) {
    let obj = {
      secid: 0,
      val: 0,
      fClose: 0,
      UCkt: 0,
      LCkt: 0,
      ATP: 0,
      OI: 0,
      LTT: 0,
      VOL: 0,
      LTQ: 0,
      fOpen: 0,
      fHigh: 0,
      fLow: 0,
    };

    obj.secid = arg;
    obj.val = val;
    obj.fClose = fClose;
    obj.UCkt = UCkt;
    obj.LCkt = LCkt;
    obj.ATP = ATP;
    obj.OI = OI;
    obj.LTT = LTT;
    obj.VOL = VOL;
    obj.LTQ = LTQ;
    obj.fOpen = fOpen;
    obj.fHigh = fHigh;
    obj.fLow = fLow;

    if (val > 0) this.messageSource.next(obj);
  }
}

function getSignalRSeg(exch: string, seg: string): number {
  if (exch == 'NSE') {
    if (seg == 'E' || seg == 'nse_cm') {
      return 1;
    } else if (seg == 'D' || seg == 'nse_fo') {
      return 2;
    } else if (seg == 'C' || seg == 'cde_fo') {
      return 3;
    }
  } else if (exch == 'BSE') {
    if (seg == 'E' || seg == 'bse_cm') {
      return 4;
    } else if (seg == 'C' || seg == 'bcs_fo') {
      return 7;
    }
  } else if (exch == 'MCX') {
    if (seg == 'M' || seg == 'mcx_fo') {
      return 5;
    }
  } else if (exch == 'NCDEX') {
    if (seg == 'M' || seg == 'ncx_fo') {
      return 6;
    }
  } else if (exch == 'IDX') {
    if (seg == 'I') {
      return 0;
    }
  } else {
    return -1;
  }
}
function pad(a, b, c, d) {
  for (var i = a.length; i < b; i++) a += c;
  return a;
}
